{% extends "dashboard/base.html" %}
{% block title %}إنشاء مجموعة كروت جديدة{% endblock %}
{% block page_subtitle %}إنشاء مجموعة كروت{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">

    <!-- Header -->
    <div class="flex items-center gap-4 mb-6">
        <a href="{% url 'vouchers:list' %}" class="btn-secondary p-3 rounded-xl hover:text-accent transition-colors">
            <i data-lucide="arrow-right" class="w-5 h-5"></i>
        </a>
        <div>
            <h2 class="text-2xl font-bold">إنشاء مجموعة كروت جديدة</h2>
            <p class="text-dark-400 text-sm mt-1">قم بتعبئة بيانات المجموعة وسيتم إنشاء الكروت تلقائياً</p>
        </div>
    </div>

    <!-- Form Card -->
    <div class="glass-card rounded-2xl p-6 glow-border">
        <form method="post" class="space-y-6">
            {% csrf_token %}

            {% if form.errors or form.non_field_errors %}
            <div class="p-4 rounded-xl bg-danger/10 border border-danger/30">
                <div class="flex items-start gap-3">
                    <i data-lucide="alert-circle" class="w-5 h-5 text-danger mt-0.5"></i>
                    <div>
                        <p class="font-medium text-danger">يرجى تصحيح الأخطاء التالية:</p>
                        <ul class="list-disc pr-6 text-sm text-dark-300 mt-2 space-y-1">
                            {% for field in form %}
                            {% for error in field.errors %}
                            <li>{{ field.label }}: {{ error }}</li>
                            {% endfor %}
                            {% endfor %}
                            {% for error in form.non_field_errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Server + Offer -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                    <label class="block text-sm font-medium text-dark-300 mb-2">
                        <i data-lucide="server" class="w-4 h-4 inline ml-1 text-accent"></i>
                        {{ form.server.label }}
                    </label>
                    {{ form.server }}
                    {% if form.server.errors %}
                    <p class="text-danger text-xs mt-1">{{ form.server.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label class="block text-sm font-medium text-dark-300 mb-2">
                        <i data-lucide="tag" class="w-4 h-4 inline ml-1 text-accent"></i>
                        {{ form.offer.label }}
                    </label>
                    {{ form.offer }}
                    {% if form.offer.errors %}
                    <p class="text-danger text-xs mt-1">{{ form.offer.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Name + Quantity -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                    <label class="block text-sm font-medium text-dark-300 mb-2">
                        <i data-lucide="file-text" class="w-4 h-4 inline ml-1 text-accent"></i>
                        {{ form.name.label }}
                    </label>
                    {{ form.name }}
                    {% if form.name.errors %}
                    <p class="text-danger text-xs mt-1">{{ form.name.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label class="block text-sm font-medium text-dark-300 mb-2">
                        <i data-lucide="hash" class="w-4 h-4 inline ml-1 text-accent"></i>
                        {{ form.quantity.label }}
                    </label>
                    {{ form.quantity }}
                    {% if form.quantity.errors %}
                    <p class="text-danger text-xs mt-1">{{ form.quantity.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Duration + Price -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                    <label class="block text-sm font-medium text-dark-300 mb-2">
                        <i data-lucide="clock" class="w-4 h-4 inline ml-1 text-accent"></i>
                        {{ form.duration_days.label }}
                    </label>
                    {{ form.duration_days }}
                    {% if form.duration_days.errors %}
                    <p class="text-danger text-xs mt-1">{{ form.duration_days.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label class="block text-sm font-medium text-dark-300 mb-2">
                        <i data-lucide="banknote" class="w-4 h-4 inline ml-1 text-accent"></i>
                        {{ form.price_per_voucher.label }}
                    </label>
                    {{ form.price_per_voucher }}
                    {% if form.price_per_voucher.errors %}
                    <p class="text-danger text-xs mt-1">{{ form.price_per_voucher.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Divider -->
            <div class="relative py-4">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-white/10"></div>
                </div>
                <div class="relative flex justify-center">
                    <span class="px-4 text-sm text-dark-400 bg-dark-900">إعدادات السيريال</span>
                </div>
            </div>

            <!-- Serial Settings -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                <div>
                    <label class="block text-sm font-medium text-dark-300 mb-2">
                        <i data-lucide="ruler" class="w-4 h-4 inline ml-1 text-accent"></i>
                        {{ form.serial_length.label }}
                    </label>
                    {{ form.serial_length }}
                    {% if form.serial_length.errors %}
                    <p class="text-danger text-xs mt-1">{{ form.serial_length.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label class="block text-sm font-medium text-dark-300 mb-2">
                        <i data-lucide="type" class="w-4 h-4 inline ml-1 text-accent"></i>
                        {{ form.serial_type.label }}
                    </label>
                    {{ form.serial_type }}
                    {% if form.serial_type.errors %}
                    <p class="text-danger text-xs mt-1">{{ form.serial_type.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label class="block text-sm font-medium text-dark-300 mb-2">
                        <i data-lucide="at-sign" class="w-4 h-4 inline ml-1 text-accent"></i>
                        {{ form.prefix.label }}
                    </label>
                    {{ form.prefix }}
                    {% if form.prefix.errors %}
                    <p class="text-danger text-xs mt-1">{{ form.prefix.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex gap-3 pt-6 border-t border-white/10">
                <button type="submit"
                    class="btn-primary flex-1 py-3.5 rounded-xl font-medium inline-flex items-center justify-center gap-2">
                    <i data-lucide="sparkles" class="w-5 h-5"></i>
                    إنشاء المجموعة
                </button>
                <a href="{% url 'vouchers:list' %}"
                    class="btn-secondary flex-1 py-3.5 rounded-xl font-medium text-center">
                    إلغاء
                </a>
            </div>
        </form>
    </div>
</div>

<script>lucide.createIcons();</script>
{% endblock %}