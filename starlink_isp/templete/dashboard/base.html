{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <script src="https://cdn.tailwindcss.com"></script>

</head>

<body>

    <!-- Hamburger button and overlay for mobile menu -->
    <div class="menu-overlay" id="menuOverlay"></div>

    {% if messages %}
    <div
        class="fixed top-5 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-md space-y-2 px-4 pointer-events-none">

        {% for message in messages %}
        {% if "dashboard_msg" in message.tags %}

        <div class="toast-message pointer-events-auto flex items-center w-full p-4 mb-4 text-gray-500 bg-white 
                    rounded-lg shadow-lg border-r-4
                    {% if message.tags == 'error' %}border-red-500
                    {% elif message.tags == 'success' %}border-green-500
                    {% else %}border-blue-500{% endif %}" role="alert">

            <div class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8 rounded-lg
                        {% if message.tags == 'error' %}text-red-500 bg-red-100
                        {% elif message.tags == 'success' %}text-green-500 bg-green-100
                        {% else %}text-blue-500 bg-blue-100{% endif %}">

                <!-- Icons (same as your original template) -->
                {% if message.tags == 'error' %}
                <svg class="w-5 h-5" ...> â€¦ </svg>
                {% elif message.tags == 'success' %}
                <svg class="w-5 h-5" ...> â€¦ </svg>
                {% else %}
                <svg class="w-5 h-5" ...> â€¦ </svg>
                {% endif %}
            </div>

            <div class="mr-3 text-sm font-medium text-gray-800">{{ message }}</div>

            <button type="button" class="mr-auto -mx-1.5 -my-1.5 ..." onclick="this.parentElement.remove()">
                <svg class="w-3 h-3" ...></svg>
            </button>
        </div>

        {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    <div class="sidebar" id="sidebar">
        <h2 class="logo">
            <img src="/media/logos/algaswaaDashboard.png" alt="">
        </h2>

        <ul class="menu">
            <li><a href="/dashboard/">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="/servers/">Ø§Ù„Ø®ÙˆØ§Ø¯Ù…</a></li>
            <li><a href="/offers/">Ø§Ù„Ø¹Ø±ÙˆØ¶</a></li>
            <li><a href="/vouchers/">Ø§Ù„ÙƒØ±ÙˆØª</a></li>
            <li><a href="/online/">Ø§Ù„ÙƒØ±ÙˆØª Ø§Ù„Ù…ØªØµÙ„Ø©</a></li>
            <li><a href="/income/">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</a></li>
            <li><a href="/design/">Ø§Ù„ØªØµØ§Ù…ÙŠÙ…</a></li>
            <li><a href="/profile/">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a></li>
        </ul>

        <div class="sidebar-footer">
            <a href="{% url 'logout' %}" class="logout-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </a>
        </div>
    </div>

    <div class="main-container">
        <header class="header">
            <div class="header-content">
                <button class="hamburger-btn md:hidden" id="hamburgerBtn">â˜°</button>
                <div>
                    <h1>Ù…Ø±Ø­Ø¨Ø§ØŒ {{ user.username }}</h1>
                </div>
                <div class="header-info relative">
                    <button class="user-info focus:outline-none" id="userMenuBtn">
                        <div class="user-avatar">{{ user.username | first | upper }}</div>
                        <span class="user-name" style="font-weight: 600; color: var(--dark);">{{ user.username}}</span>
                        <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </button>
                    <!-- Dropdown Menu -->
                    <div id="userMenuDropdown"
                        class="hidden absolute top-full left-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-gray-100 py-1 z-50">
                        <a href="/profile/"
                            class="flex items-center gap-2 px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 hover:text-blue-600 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                        </a>
                        <div class="h-px bg-gray-100 my-1"></div>
                        <a href="{% url 'logout' %}"
                            class="flex items-center gap-2 px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                                </path>
                            </svg>
                            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <main class="content">
            <div class="content-wrapper">
                {% if plan %}
                <div class="plan-hero">
                    <h2>{{ plan.name }}</h2>
                    <p>{{ plan.description }}</p>


                    <div class="mt-6 rounded-2xl bg-gradient-to-br from-white to-gray-50 border shadow-sm p-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

                            <!-- SUPPORT CARD -->
                            <div class="rounded-xl bg-white border p-5 hover:shadow transition">
                                <div class="flex items-center gap-2 mb-4">
                                    <div
                                        class="w-9 h-9 flex items-center justify-center rounded-full bg-blue-100 text-blue-600">
                                        ğŸ“
                                    </div>
                                    <h3 class="font-bold text-gray-800">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</h3>
                                </div>

                                <div class="space-y-3 text-sm">
                                    <div>
                                        <div class="text-gray-500">Ø§Ù„Ø§Ø³Ù…</div>
                                        <div class="font-semibold text-gray-900">
                                            {{ tech_support.name }}
                                        </div>
                                    </div>

                                    <div>
                                        <div class="text-gray-500">Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„</div>

                                        <div
                                            class="flex items-center justify-between bg-gray-50 rounded-lg px-3 py-2 mt-1">
                                            <span class="font-mono">{{ tech_support.phone }}</span>

                                            <div class="flex items-center gap-2">
                                                <!-- COPY -->
                                                <button onclick="copyText('{{ tech_support.phone }}')"
                                                    class="text-xs text-blue-600 hover:underline">
                                                    Ù†Ø³Ø®
                                                </button>

                                                <!-- WHATSAPP -->
                                                <a href="https://wa.me/{{ tech_support.phone }}" target="_blank"
                                                    class="flex items-center gap-1 text-green-600 hover:text-green-700 text-xs font-semibold">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4"
                                                        viewBox="0 0 24 24" fill="currentColor">
                                                        <path
                                                            d="M12.04 2.01C6.58 2.01 2.15 6.44 2.15 11.9c0 1.93.5 3.82 1.45 5.5L2 22l4.7-1.53c1.6.87 3.4 1.32 5.34 1.32h.01c5.46 0 9.89-4.43 9.89-9.89S17.5 2.01 12.04 2.01zm5.73 14.2c-.24.68-1.42 1.3-1.96 1.38-.5.08-1.12.12-1.8-.12-.42-.14-.96-.31-1.66-.61-2.92-1.26-4.82-4.2-4.97-4.4-.15-.2-1.19-1.58-1.19-3.02 0-1.44.75-2.15 1.02-2.45.27-.3.6-.38.8-.38.2 0 .4 0 .57.01.18.01.42-.07.66.5.24.58.82 2 .89 2.15.07.15.12.33.02.53-.1.2-.15.33-.3.5-.15.18-.31.4-.44.54-.15.15-.31.32-.13.63.18.3.8 1.33 1.72 2.15 1.18 1.05 2.17 1.38 2.48 1.53.31.15.5.13.68-.08.18-.2.78-.9.99-1.2.2-.3.4-.25.68-.15.27.1 1.7.8 2 .95.3.15.5.22.57.35.07.12.07.7-.17 1.38z" />
                                                    </svg>
                                                    ÙˆØ§ØªØ³Ø§Ø¨
                                                </a>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                            </div>

                            <!-- BANK CARD -->
                            <div class="rounded-xl bg-white border p-5 hover:shadow transition">
                                <div class="flex items-center gap-2 mb-4">
                                    <div
                                        class="w-9 h-9 flex items-center justify-center rounded-full bg-green-100 text-green-600">
                                        ğŸ¦
                                    </div>
                                    <h3 class="font-bold text-gray-800">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ</h3>
                                </div>

                                <div class="space-y-3 text-sm">
                                    <div>
                                        <div class="text-gray-500">Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</div>
                                        <div class="font-semibold text-gray-900">
                                            {{ tech_support.bank_name }}
                                        </div>
                                    </div>

                                    <div>
                                        <div class="text-gray-500">Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨</div>
                                        <div
                                            class="flex items-center justify-between bg-gray-50 rounded-lg px-3 py-2 mt-1">
                                            <span class="font-mono">{{ tech_support.bank_account_holder }}</span>
                                            <button onclick="copyText('{{ tech_support.bank_account_holder }}')"
                                                class="text-xs text-blue-600 hover:underline">
                                                Ù†Ø³Ø®
                                            </button>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="text-gray-500">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</div>
                                        <div
                                            class="flex items-center justify-between bg-gray-50 rounded-lg px-3 py-2 mt-1">
                                            <span class="font-mono">{{ tech_support.bank_account_number }}</span>
                                            <button onclick="copyText('{{ tech_support.bank_account_number }}')"
                                                class="text-xs text-blue-600 hover:underline">
                                                Ù†Ø³Ø®
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ACCOUNT CARD -->
                            <div class="rounded-xl bg-white border p-5 hover:shadow transition">
                                <div class="flex items-center gap-2 mb-4">
                                    <div
                                        class="w-9 h-9 flex items-center justify-center rounded-full bg-purple-100 text-purple-600">
                                        ğŸ‘¤
                                    </div>
                                    <h3 class="font-bold text-gray-800">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
                                </div>

                                <div class="space-y-3 text-sm">
                                    <div>
                                        <div class="text-gray-500">Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨Ùƒ</div>
                                        <div
                                            class="font-mono font-semibold text-gray-900 flex items-center justify-between">
                                            <span>{{ user.id }}</span>
                                            <button onclick="copyText('{{ user.id }}')"
                                                class="text-xs text-blue-600 hover:underline mr-2">
                                                Ù†Ø³Ø®
                                            </button>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="font-semibold text-gray-900">
                                            {{ next_payment_date }}
                                        </div>
                                    </div>

                                    <div>
                                        <div class="text-gray-500">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚</div>
                                        <div class="font-semibold text-red-600">
                                            {% if user.has_paied %}
                                            0
                                            {% else %}
                                            {{ user.plan.price }}
                                            {% endif %}
                                        </div>
                                    </div>

                                    <div class="mt-4 text-xs text-gray-500 bg-gray-50 rounded-lg p-3">
                                        âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ø¹ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„ØªÙØ¹ÙŠÙ„
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>


                    <div class="mt-6">

                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø®ÙˆØ§Ø¯Ù…</div>
                            <div class="stat-value">{{ total_servers }}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† Ø§Ù„Ø¢Ù†</div>
                            <div class="stat-value">{{ online_vouchers }}</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØ±ÙˆØª Ø§Ù„Ù…ÙÙ†Ø´Ø£Ø©</div>
                            <div class="stat-value">{{ total_vouchers_created }}</div>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% block content %}
                {% endblock %}
            </div>
        </main>
    </div>

    <!-- JavaScript for mobile menu toggle functionality -->
    <script>
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const sidebar = document.getElementById('sidebar');
        const menuOverlay = document.getElementById('menuOverlay');
        function copyText(text) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => showToast("ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ”"), () => fallbackCopyTextToClipboard(text));
            } else {
                fallbackCopyTextToClipboard(text);
            }
        }
        function fallbackCopyTextToClipboard(text) {
            var textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";  // Avoid scrolling to bottom
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                var successful = document.execCommand('copy');
                if (successful) showToast("ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ”");
                else showToast("ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® âŒ");
            } catch (err) {
                showToast("ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® âŒ");
            }
            document.body.removeChild(textArea);
        }
        function showToast(msg) {
            const toast = document.createElement("div");
            toast.innerText = msg;
            toast.className = "fixed bottom-6 left-1/2 -translate-x-1/2 bg-black text-white text-sm px-4 py-2 rounded-lg shadow z-[60]";
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 1500);
        }

        // Dropdown toggle
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userMenuDropdown = document.getElementById('userMenuDropdown');

        if (userMenuBtn && userMenuDropdown) {
            userMenuBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                userMenuDropdown.classList.toggle('hidden');
            });

            document.addEventListener('click', (e) => {
                if (!userMenuDropdown.contains(e.target) && !userMenuBtn.contains(e.target)) {
                    userMenuDropdown.classList.add('hidden');
                }
            });
        }

        hamburgerBtn.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            menuOverlay.classList.toggle('active');
        });

        menuOverlay.addEventListener('click', () => {
            sidebar.classList.remove('active');
            menuOverlay.classList.remove('active');
        });

        document.querySelectorAll('.menu a').forEach(link => {
            link.addEventListener('click', () => {
                sidebar.classList.remove('active');
                menuOverlay.classList.remove('active');
            });
        });
    </script>
</body>

</html>